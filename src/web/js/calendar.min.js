"use strict";function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}document.addEventListener("DOMContentLoaded",function(){(function(a,b){var c=Math.floor;function d(){this.id=null,this.calendarId=null,this.title=null,this.body=null,this.location=null,this.isAllday=!1,this.start=null,this.end=null,this.category="",this.dueDateClass="",this.color=null,this.bgColor=null,this.dragBgColor=null,this.borderColor=null,this.customStyle="",this.isFocused=!1,this.isPending=!1,this.isVisible=!0,this.isReadOnly=!1,this.isPrivate=!1,this.goingDuration=0,this.comingDuration=0,this.recurrenceRule="",this.state="",this.raw={memo:"",hasToOrCc:!1,hasRecurrenceRule:!1,location:null,creator:{name:"",avatar:"",company:"",email:"",phone:""}}}function e(a,b,d){var e,f=moment(b.getTime()),g=moment(d.getTime()),h=g.diff(f,"days");5<c(10*Math.random())?(a.isAllday=!0,e=1):(a.isAllday=!1,e=0),a.isAllday?a.category="allday":8<c(10*Math.random())?(a.category=J[e],a.category===J[1]&&(a.dueDateClass="morning")):a.category="time",f.add(c(Math.random()*h),"days"),f.hours(c(23*Math.random())),f.minutes(0===e?0:30),a.start=f.toDate(),g=moment(f),a.isAllday&&g.add(1,"days"),a.end=g.add(1,"hour").toDate(),!a.isAllday&&8<c(10*Math.random())&&(a.goingDuration=c(90*Math.random())+30,a.comingDuration=c(90*Math.random())+30,9<=c(10*Math.random())&&(a.end=a.start))}function f(a,b,c){var f=new d;f.id=1,f.calendarId=a.id,f.title="title",f.body="body of event",f.isReadOnly=!1,e(f,b,c),f.isPrivate=!1,f.location="",f.attendees=[],f.recurrenceRule="",f.state="Free",f.color=a.color,f.bgColor=a.bgColor,f.dragBgColor=a.dragBgColor,f.borderColor=a.borderColor,"milestone"===f.category&&(f.color=f.bgColor,f.bgColor="transparent",f.dragBgColor="transparent",f.borderColor="transparent"),f.raw.memo="memo",f.raw.creator.name="creator name",f.raw.creator.avatar="",f.raw.creator.company="company",f.raw.creator.email="email",f.raw.creator.phone="phone",I.push(f)}function g(a,b,c){I=[],H.forEach(function(d){var e=0,g=10;for("month"===a?g=3:"day"==a&&(g=4);e<g;e+=1)f(d,b,c)})}function h(){this.id=null,this.name=null,this.checked=!0,this.color=null,this.bgColor=null,this.borderColor=null,this.dragBgColor=null}function i(a){var b;return H.forEach(function(c){c.id===a&&(b=c)}),b||H[0]}function j(){return k.apply(this,arguments)}function k(){return k=_asyncToGenerator(regeneratorRuntime.mark(function a(){var b,c,d,e;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=1,d=[],e=[{color:"#ffffff",bgColor:"#9e5fff",dragBgColor:"#9e5fff"},{color:"#ffffff",bgColor:"#00a9ff",dragBgColor:"#00a9ff"},{color:"#ffffff",bgColor:"#ff5583",dragBgColor:"#ff5583"}],a.next=5,fetch("/iot/device/index").then(function(a){return a.json()}).then(function(a){Object.values(a.devices).forEach(function(a){b=new h,b.id=c+"",b.name=a,b.color=e[c-1].color,b.bgColor=e[c-1].bgColor,b.dragBgColor=e[c-1].dragBgColor,b.borderColor=e[c-1].dragBgColor,d.push(b),c+=1})});case 5:return a.abrupt("return",d);case 6:case"end":return a.stop();}},a)})),k.apply(this,arguments)}function l(a,b){var c=[],d=moment(a.start.toUTCString());return b||c.push("<strong>"+d.format("HH:mm")+"</strong> "),a.isPrivate?(c.push("<span class=\"calendar-font-icon ic-lock-b\"></span>"),c.push(" Private")):(a.isReadOnly?c.push("<span class=\"calendar-font-icon ic-readonly-b\"></span>"):a.recurrenceRule?c.push("<span class=\"calendar-font-icon ic-repeat-b\"></span>"):a.attendees.length?c.push("<span class=\"calendar-font-icon ic-user-b\"></span>"):a.location&&c.push("<span class=\"calendar-font-icon ic-location-b\"></span>"),c.push(" "+a.title)),c.join("")}function m(a){var b=a.target.closest("a[role=\"menuitem\"]")[0],c=A(b),d=D.getOptions(),e="";switch(console.log(b),console.log(c),c){case"toggle-daily":e="day";break;case"toggle-weekly":e="week";break;case"toggle-monthly":d.month.visibleWeeksCount=0,e="month";break;case"toggle-weeks2":d.month.visibleWeeksCount=2,e="month";break;case"toggle-weeks3":d.month.visibleWeeksCount=3,e="month";break;case"toggle-narrow-weekend":d.month.narrowWeekend=!d.month.narrowWeekend,d.week.narrowWeekend=!d.week.narrowWeekend,e=D.getViewName(),b.querySelector("input").checked=d.month.narrowWeekend;break;case"toggle-start-day-1":d.month.startDayOfWeek=d.month.startDayOfWeek?0:1,d.week.startDayOfWeek=d.week.startDayOfWeek?0:1,e=D.getViewName(),b.querySelector("input").checked=d.month.startDayOfWeek;break;case"toggle-workweek":d.month.workweek=!d.month.workweek,d.week.workweek=!d.week.workweek,e=D.getViewName(),b.querySelector("input").checked=!d.month.workweek;break;default:}D.setOptions(d,!0),D.changeView(e,!0),v(),x(),y()}function n(a){var b=A(a.target);switch(b){case"move-prev":D.prev();break;case"move-next":D.next();break;case"move-today":D.today();break;default:return;}x(),y()}function o(){var a=document.getElementById("new-schedule-title").value,b=document.getElementById("new-schedule-location").value,d=document.getElementById("new-schedule-allday").checked,e=F.getStartDate(),f=F.getEndDate(),g=G?G:H[0];a&&(D.createSchedules([{id:c(1e6*Math.random())+"",calendarId:g.id,title:a,isAllDay:d,location:b,start:e,end:f,category:d?"allday":"time",dueDateClass:"",color:g.color,bgColor:g.bgColor,dragBgColor:g.bgColor,borderColor:g.borderColor,state:"Busy"}]),$("#modal-new-schedule").modal("hide"))}function p(a){var b=a.target.closest("a[role=\"menuitem\"]")[0],c=A(b);q(c)}function q(a){var b=document.getElementById("calendarName"),c=i(a),d=[];d.push("<span class=\"calendar-bar\" style=\"background-color: "+c.bgColor+"; border-color:"+c.borderColor+";\"></span>"),d.push("<span class=\"calendar-name\">"+c.name+"</span>"),b.innerHTML=d.join(""),G=c}function r(a){var b=a.start?new Date(a.start.getTime()):new Date,c=a.end?new Date(a.end.getTime()):moment().add(1,"hours").toDate();D.openCreationPopup({start:b,end:c})}function s(a){var b=a.calendar||i(a.calendarId),d={id:c(1e6*Math.random())+"",title:a.title,isAllDay:a.isAllDay,start:a.start,end:a.end,category:a.isAllDay?"allday":"time",dueDateClass:"",color:b.color,bgColor:b.bgColor,dragBgColor:b.bgColor,borderColor:b.borderColor,location:a.location,isPrivate:a.isPrivate,state:a.state};b&&(d.calendarId=b.id,d.color=b.color,d.bgColor=b.bgColor,d.borderColor=b.borderColor),D.createSchedules([d]),u()}function t(a){var b=a.target.value,c=a.target.checked,d=document.querySelector(".lnb-calendars-item input"),e=Array.prototype.slice.call(document.querySelectorAll("#calendarList input")),f=!0;"all"===b?(f=c,e.forEach(function(a){var b=a.parentNode;a.checked=c,b.style.backgroundColor=c?b.style.borderColor:"transparent"}),H.forEach(function(a){a.checked=c})):(i(b).checked=c,f=e.every(function(a){return a.checked}),d.checked=!!f),u()}function u(){var a=Array.prototype.slice.call(document.querySelectorAll("#calendarList input"));H.forEach(function(a){D.toggleSchedules(a.id,!a.checked,!1)}),D.render(!0),a.forEach(function(a){var b=a.nextElementSibling;b.style.backgroundColor=a.checked?b.style.borderColor:"transparent"})}function v(){var a,b=document.getElementById("calendarTypeName"),c=document.getElementById("calendarTypeIcon"),d=D.getOptions(),e=D.getViewName();"day"===e?(e="Daily",a="calendar-icon ic_view_day"):"week"===e?(e="Weekly",a="calendar-icon ic_view_week"):2===d.month.visibleWeeksCount?(e="2 weeks",a="calendar-icon ic_view_week"):3===d.month.visibleWeeksCount?(e="3 weeks",a="calendar-icon ic_view_week"):(e="Monthly",a="calendar-icon ic_view_month"),b.innerHTML=e,c.className=a}function w(a){var b=moment([D.getDate().getFullYear(),D.getDate().getMonth(),D.getDate().getDate()]);return b.format(a)}function x(){var a=document.getElementById("renderRange"),b=D.getOptions(),c=D.getViewName(),d=[];"day"===c?d.push(w("YYYY.MM.DD")):"month"===c&&(!b.month.visibleWeeksCount||4<b.month.visibleWeeksCount)?d.push(w("YYYY.MM")):(d.push(moment(D.getDateRangeStart().getTime()).format("YYYY.MM.DD")),d.push(" ~ "),d.push(moment(D.getDateRangeEnd().getTime()).format(" MM.DD"))),a.innerHTML=d.join("")}function y(){D.clear(),g(D.getViewName(),D.getDateRangeStart(),D.getDateRangeEnd()),D.createSchedules(I),u()}function z(){document.querySelector("body").addEventListener("click",function(a){"menu-navi"===a.target.id&&n(a),"btn-save-schedule"===a.target.id&&o(),"btn-new-schedule"===a.target.id&&r(a),"dropdownMenu-calendars-list"===a.target.id&&p(a),a.target.classList.contains("dropdown-menu-title")&&a.target.hasAttribute("role")&&"menuitem"===a.target.getAttribute("role")&&m(a)}),document.querySelector("body").addEventListener("change",function(a){"lnb-calendars"===a.target.id&&t(a)}),a.addEventListener("resize",E)}function A(a){return a.dataset?a.dataset.action:a.getAttribute("data-action")}function B(){return C.apply(this,arguments)}function C(){return C=_asyncToGenerator(regeneratorRuntime.mark(function a(){var b,c,d;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=document.getElementById("calendarList"),c=[],a.next=4,j();case 4:d=a.sent,H=d,d.forEach(function(a){c.push("<div class=\"lnb-calendars-item\"><label><input type=\"checkbox\" class=\"tui-full-calendar-checkbox-round\" value=\""+a.id+"\" checked><span style=\"border-color: "+a.borderColor+"; background-color: "+a.borderColor+";\"></span><span>"+a.name+"</span></label></div>")}),b.innerHTML=c.join("\n");case 8:case"end":return a.stop();}},a)})),C.apply(this,arguments)}var D,E,F,G,H=[],I=[],J=["milestone","task"];D=new b("#calendar",{defaultView:"week",useCreationPopup:!0,useDetailPopup:!0,calendars:H,template:{milestone:function milestone(a){return"<span class=\"calendar-font-icon ic-milestone-b\"></span> <span style=\"background-color: "+a.bgColor+"\">"+a.title+"</span>"},allday:function allday(a){return l(a,!0)},time:function time(a){return l(a,!1)}}}),D.on({clickMore:function clickMore(a){console.log("clickMore",a)},clickSchedule:function clickSchedule(a){console.log("clickSchedule",a)},clickDayname:function clickDayname(a){console.log("clickDayname",a)},beforeCreateSchedule:function beforeCreateSchedule(a){console.log("beforeCreateSchedule",a),s(a)},beforeUpdateSchedule:function beforeUpdateSchedule(a){var b=a.schedule,c=a.changes;console.log("beforeUpdateSchedule",a),c&&!c.isAllDay&&"allday"===b.category&&(c.category="time"),D.updateSchedule(b.id,b.calendarId,c),u()},beforeDeleteSchedule:function beforeDeleteSchedule(a){console.log("beforeDeleteSchedule",a),D.deleteSchedule(a.schedule.id,a.schedule.calendarId)},afterRenderSchedule:function afterRenderSchedule(a){a.schedule},clickTimezonesCollapseBtn:function clickTimezonesCollapseBtn(a){return console.log("timezonesCollapsed",a),a?D.setTheme({"week.daygridLeft.width":"77px","week.timegridLeft.width":"77px"}):D.setTheme({"week.daygridLeft.width":"60px","week.timegridLeft.width":"60px"}),!0}}),E=tui.util.throttle(function(){D.render()},50),a.cal=D,v(),x(),y(),z(),B()})(window,tui.Calendar)});
